.PHONY: default all clean

include project.conf
PROJECT_ARCHIVE=$(PROJECT_NAME)-$(PROJECT_VERSION)

DESTDIR ?=
PREFIX ?= $HOME/.local
BINDIR ?= $(PREFIX)/bin
DATADIR ?= $(PREFIX)/share

# Interner Binary-Name bleibt "laby"
INTERNAL_BIN=laby
# Installierter Name wird "filaby"
INSTALLED_BIN=filaby

default: all

all:
	@./build --all

clean:
	@./build --clean

byte native byte-debug native-profile:
	@./build --$@

install:
	# Binary installieren unter neuem Namen
	install -Dp --mode=0755 $(INTERNAL_BIN) \
		"$(DESTDIR)$(BINDIR)/$(INSTALLED_BIN)"

	# Daten installieren
	install -d "$(DESTDIR)$(DATADIR)/laby/"
	cp -pr data/* "$(DESTDIR)$(DATADIR)/laby/"

	# Icon installieren unter neuem Namen
	install -Dp --mode=0644 data/tiles/ant-e_f.svg \
		"$(DESTDIR)$(DATADIR)/icons/hicolor/scalable/apps/filaby.svg"

	# Desktop-Datei installieren unter neuem Namen
	desktop-file-install packaging/laby.desktop \
		--dir="$(DESTDIR)$(DATADIR)/applications" \
		--recode-to-utf8 \
		--set-key=Name:Filaby \
		--set-key=Exec:$(INSTALLED_BIN) \
		--set-key=Icon:filaby

	# AppData installieren
	install -Dp --mode=0644 packaging/laby.appdata.xml \
		"$(DESTDIR)$(DATADIR)/appdata/$(INSTALLED_BIN).appdata.xml"

dist:
	@mkdir _dist
	@git archive --prefix="$(PROJECT_ARCHIVE)/" HEAD \
		 | gzip >"_dist/$(PROJECT_ARCHIVE).tar.gz"
	@echo archive stored in "_dist/$(PROJECT_ARCHIVE).tar.gz"
